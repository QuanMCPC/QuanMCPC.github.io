<!--Created by QuanMCPC, used Bootstrap Icon for the icon-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SOOPE (Simple and Open-Source Picture Editor)</title>
        <style>
            body { margin: 0; }
            #access_bar {
                position: relative;
                width: auto;
                height: 30%;
                background-color: #c0c0c0;
                padding: 5px;
                border: 2px solid black;
            }
            #access_bar > *, #toolbar > *:not(.vr), .dropdown_button, .normal > * {
                display: inline-block;
                margin: 0px;
            }
            .dropdown_content {
                position: absolute;
                background-color: #c0c0c0;
                border: 1px solid black;
                padding: 5px;
            }
            #dropdown_settings * { margin: 2px }
            #toolbar {
                display: grid;
                grid-template-columns: repeat(11, max-content);
                width: max-content;
            }
            svg {
                margin-left: auto;
                margin-right: auto;
                display: block;
            }
            figure { padding: 5px; -webkit-user-select: none; user-select: none; margin: 0; }
            figure:hover {
                background-color: #838383;
                cursor: pointer;
                margin: 0;
            }
            figure:hover:active {
                background-color: #727272;
            }
            canvas {
                margin: 5px;
            }
            #cursor_image, #pencil_cursor_image, #pencil_cursor_image_2 {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1;
                pointer-events: none;
            }
            #dropdown_settings, #dropdown_files, #dropdown_tools, #dropdown_save, #dropdown_open {
                display: none;
            }
            div#dropdown_settings_:hover div#dropdown_settings { display: block; }
            div#dropdown_save_:hover div#dropdown_save { display: block; }
            div#dropdown_open_:hover div#dropdown_open { display: block; }
            div#dropdown_files_:hover div#dropdown_files { display: flex; }
            div#dropdown_tools_:hover div#dropdown_tools { display: flex; }
            div.vr {
                height: 100%;
                width: 1px;
                border-left: 1px solid gray;
                margin-left: 7px;
                margin-right: 7px;
            }
            #about, #kbsc {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: auto;
                background-color: #c0c0c0;
                border: 1px solid black;
                padding: 5px;
                z-index: 6;
            }
            #about *, #kbsc * { margin: 5px; }
            #about_, #kbsc_ {
                background-color: rgba(0, 0, 0, 0.8);
                z-index: 5;
                width: 100%;
                height: 100%;
                position: absolute;
                top: 0;
                left: 0;
            }
            #about__, #kbsc__ { display: none; }
            #fullscreen {
                width: 100%;
                height: 100%;
                background-color: black;
                position: absolute;
                top: 0;
                left: 0;
                display: none;
                z-index: 10;
            }
            #fullscreen * {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                max-width: auto;
                max-height: 100%;
            }
            #lockRatio, #lockRatio1 {
                margin: 0;
                display: inline;
                padding: 2px;
            }
            #lockRatio:hover { background-color: #838383 }
            #lockRatio:hover:active { background-color: #727272 }
        </style>
    </head>
    <body>
        <p id="a" style="display: none;">Test</p>
        <div id="access_bar">
            <div id="toolbar">
                <div class="dropdown_bottom" id="dropdown_files_">
                    <figure id="files">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                        </svg>
                        <figcaption id="dropdown_files__name">Files...</figcaption>
                    </figure>
                    <div class="dropdown_content" id="dropdown_files" style="z-index: 2;"></div>
                </div>
                <div id="normal_files" class="normal">
                    <figure onclick="newImage()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                        </svg>
                        <figcaption>New</figcaption>
                    </figure>
                    <div id="dropdown_open_" class="dropdown_bottom" style="width: max-content">
                        <figure>
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/>
                            </svg>
                            <figcaption>Open</figcaption>
                        </figure>
                        <div id="dropdown_open" class="dropdown_content" style="width: max-content">
                            <fieldset>
                                <legend>Open</legend>
                                <button onclick="openImage(false)">Open normal image file</button><br>
                                <button onclick="openImage(true)">Open base64 encoded image file</button>
                            </fieldset>
                        </div>
                    </div>
                    <div id="dropdown_save_" class="dropdown_bottom" style="width: max-content;">
                        <figure>
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                            </svg>
                            <figcaption>Save...</figcaption>
                        </figure>
                        <div id="dropdown_save" class="dropdown_content" style="width: max-content;">
                            <fieldset>
                                <legend>Save</legend>
                                <p style="margin-top: 0; margin-bottom: 0;">Data type: <small title="Not all format is supported save as base64 in most browser">(?)</small></p>
                                <label for="png">PNG</label><input id="png" value="image/png" type="radio" name="filetype" data-extension="png" checked>
                                <label for="jpeg">JPEG</label><input id="jpeg" value="image/jpeg" type="radio" name="filetype" data-extension="jpeg">
                                <label for="webp">WEBP</label><input id="webp" value="image/webp" type="radio" name="filetype" data-extension="webp">
                                <label for="jpg">JPG</label><input id="jpg" value="image/jpg" type="radio" name="filetype" data-extension="jpg"><br>
                                <label for="ico">ICO</label><input id="ico" value="image/ico" type="radio" name="filetype" data-extension="ico">
                                <label for="bmp">BMP</label><input id="bmp" value="image/bmp" type="radio" name="filetype" data-extension="bmp">
                                <label for="gif">GIF</label><input id="gif" value="image/gif" type="radio" name="filetype" data-extension="gif">
                                <label for="tif">TIF</label><input id="tif" value="image/tif" type="radio" name="filetype" data-extension="tif"><br>
                                <button onclick="saveImage(false)">Save as picture file</button><br>
                                <button onclick="saveImage(true)">Save as Base64 text file</button>
                            </fieldset>
                        </div>
                    </div>
                    <figure onclick="alert('Just close the tab normally')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                        <figcaption>Close</figcaption>
                    </figure>
                </div>
                <div class="vr"></div>
                <div class="dropdown_bottom" id="dropdown_tools_">
                    <figure id="tools">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M1 0L0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.356 3.356a1 1 0 0 0 1.414 0l1.586-1.586a1 1 0 0 0 0-1.414l-3.356-3.356a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0zm9.646 10.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708zM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11z"/>
                        </svg>
                        <figcaption id="dropdown_tools__name">Tools...</figcaption>
                    </figure>
                    <div class="dropdown_content" id="dropdown_tools" style="z-index: 2;"></div>
                </div>
                <div id="normal_tools" class="normal">
                    <figure class="tool__ tool__pencil" onclick="resetAllTool(); for(var i = 0; i < getClass('tool__pencil').length; i++) { getClass('tool__pencil')[i].style.backgroundColor = '#999999' }; tool_ = 'pencil'; getId('pencil_cursor_image').style.display = 'block'; getId('pencil_cursor_image_2').style.display = 'block'; getId('canvas').style.cursor = 'none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5L13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175l-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                        </svg>
                        <figcaption>Pencil</figcaption>
                    </figure>
                    <figure class="tool__ tool__eraser" onclick="resetAllTool(); for(var i = 0; i < getClass('tool__eraser').length; i++) { getClass('tool__eraser')[i].style.backgroundColor = '#999999' }; tool_ = 'eraser'; getId('cursor_image').style.display = 'block'; getId('cursor_image').style.top = getId('canvas').getBoundingClientRect().top + window.scrollY + Number(getCS(getId('canvas')).borderWidth.replace(/\D+$/g, '')) + 'px'; getId('cursor_image').style.left = getId('canvas').getBoundingClientRect().left + window.scrollX + Number(getCS(getId('canvas')).borderWidth.replace(/\D+$/g, '')) + 'px'; getId('canvas').style.cursor = 'none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414l-3.879-3.879zM8.746 13.547L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"/>
                        </svg>
                        <figcaption>Eraser</figcaption>
                    </figure>
                    <figure class="tool__ tool__colorPicker" onclick="resetAllTool(); for(var i = 0; i < getClass('tool__colorPicker').length; i++) { getClass('tool__colorPicker')[i].style.backgroundColor = '#999999' }; tool_ = 'colorpicker';">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M13.354.646a1.207 1.207 0 0 0-1.708 0L8.5 3.793l-.646-.647a.5.5 0 1 0-.708.708L8.293 5l-7.147 7.146A.5.5 0 0 0 1 12.5v1.793l-.854.854a.5.5 0 1 0 .708.707L1.707 15H3.5a.5.5 0 0 0 .354-.146L11 7.707l1.146 1.147a.5.5 0 0 0 .708-.708l-.647-.646 3.147-3.146a1.207 1.207 0 0 0 0-1.708l-2-2zM2 12.707l7-7L10.293 7l-7 7H2v-1.293z"/>
                        </svg>
                        <figcaption>Color Picker</figcaption>
                    </figure>
                    <figure class="tool__" onclick="undo()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                        </svg>
                        <figcaption>Undo</figcaption>
                    </figure>
                    <figure class="tool__" onclick="redo()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                        <figcaption>Redo</figcaption>
                    </figure>
                </div>
                <div class="vr"></div>
                <div class="dropdown_bottom" id="dropdown_settings_">
                    <figure id="settings">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                        <figcaption id="dropdown_settings__name">Settings...</figcaption>
                    </figure>
                    <div class="dropdown_content" id="dropdown_settings" style="z-index: 2;">
                        <fieldset>
                            <legend>Settings</legend>
                            <label for="brush_size" style="color: black">Pencil Size: </label><input type="number" name="brush_size" id="brush_size" value="2" style="width: 50px"><br>
                            <label for="eraser_size" style="color: black">Eraser Size: </label><input type="number" name="eraser_size" id="eraser_size" value="32" style="width: 50px"><br>
                            <label for="brush_color" style="color: black">Pencil Color: </label><input type="color" name="brush_color" id="brush_color"><br>
                            <label for="canvas_width" style="color: black">Canvas Width: </label><input type="number" name="canvas_width" id="canvas_width" value="640" style="width: 50px">
                            <svg id="lockRatio" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" onclick="lockRatio()">
                                <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z"/>
                            </svg>
                            <br>
                            <label for="canvas_height" style="color: black">Canvas Height: </label><input type="number" name="canvas_height" id="canvas_height" value="480" style="width: 50px"><br>
                            <label for="image_width" style="color: black">Image Width: </label><input type="number" name="image_width" id="image_width" value="640" style="width: 50px">
                            <svg id="lockRatio1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" onclick="lockRatio1()">
                                <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z"/>
                            </svg>
                            <br>
                            <label for="image_height" style="color: black">Image Height: </label><input type="number" name="image_height" id="image_height" value="480" style="width: 50px"><br>
                            <label for="backgroundTransparent" style="color: black">Make background transparent? </label><input type="checkbox" name="backgroundTransparent" id="backgroundTransparent">
                        </fieldset>
                    </div>
                </div>
                <figure id="keyboardshortcut" onclick="showKS()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M14 5a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h12zM2 4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2z"/>
                        <path d="M13 10.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5zm0-2a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5zm-5 0A.25.25 0 0 1 8.25 8h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 8 8.75v-.5zm2 0a.25.25 0 0 1 .25-.25h1.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-1.5a.25.25 0 0 1-.25-.25v-.5zm1 2a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5zm-5-2A.25.25 0 0 1 6.25 8h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 6 8.75v-.5zm-2 0A.25.25 0 0 1 4.25 8h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 4 8.75v-.5zm-2 0A.25.25 0 0 1 2.25 8h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 2 8.75v-.5zm11-2a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5zm-2 0a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5zm-2 0A.25.25 0 0 1 9.25 6h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 9 6.75v-.5zm-2 0A.25.25 0 0 1 7.25 6h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 7 6.75v-.5zm-2 0A.25.25 0 0 1 5.25 6h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 5 6.75v-.5zm-3 0A.25.25 0 0 1 2.25 6h1.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-1.5A.25.25 0 0 1 2 6.75v-.5zm0 4a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5zm2 0a.25.25 0 0 1 .25-.25h5.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-5.5a.25.25 0 0 1-.25-.25v-.5z"/>
                    </svg>
                    <figcaption>Shortcut</figcaption>
                </figure>
                <figure onclick="fullS()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"/>
                    </svg>
                    <figcaption>Full Screen</figcaption>
                </figure>
                <figure id="info" onclick="showAbout()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                    <figcaption>About</figcaption>
                </figure>
            </div>
        </div>
        <div id="draw_area">
            <div class="cursor_" id="cursor_image">
                <svg id="child_cursor_image" width="32" height="32" version="1.1" viewBox="0 0 8.4667 8.4667" xmlns="http://www.w3.org/2000/svg">
                    <rect x="-3.0478e-9" width="8.4667" height="8.4667" fill="#000000" stroke-width=".35857"/>
                    <rect x=".26458" y=".26458" width="7.9375" height="7.9375" fill="#ffffff" stroke-width="1.0501"/>
                </svg>
            </div>
            <div class="cursor_" id="pencil_cursor_image">
                <svg id="child_pencil_cursor_image" width="2" height="2" version="1.1" viewBox="0 0 8.4667 8.4667" xmlns="http://www.w3.org/2000/svg">
                    <circle id="child_pencil_cursor_image_child" cx="4.2333" cy="4.2333" r="4.2333" fill="#000000" stroke-width=".26608"/>
                </svg>
            </div>
            <div class="cursor_" id="pencil_cursor_image_2">
                <svg id="child_pencil_cursor_image_2" width="32" height="32" version="1.1" viewBox="0 0 8.4667 8.4667" xmlns="http://www.w3.org/2000/svg">
                    <g>
                        <path transform="scale(.26458)" d="m15 1v14h-14v2h14v14h2v-14h14v-2h-14v-14h-2z" fill="#ffffff"/>
                        <path transform="scale(.26458)" d="m14 0v14h-14v1 2 1h14v14h1 2 1v-14h14v-1-2-1h-14v-14h-1-2-1zm1 1h2v6h-2v-6zm0 7h2v6h-2v-6zm-14 7h6v2h-6v-2zm7 0h6v2h-6v-2zm7 0h2v2h-2v-2zm3 0h6v2h-6v-2zm7 0h6v2h-6v-2zm-10 3h2v6h-2v-6zm0 7h2v6h-2v-6z" fill="#4d4d4d"/>
                    </g>
                </svg>
            </div>
            <canvas id="canvas" width="640" height="480" style="width: 640px; height: 480px; border:2px solid black; z-index: 99; background-color: white"></canvas>
        </div>
        <div id="about__">
            <div id="about_"></div>
            <div id="about">
                <hr>
                <h3 style="text-align: center;">SOOPE (Simple and Open-Source Online Picture Editor)</h3>
                <hr>
                <p>Version: 1.0.0, completed at: March 13th, 2021</p>
                <p>Created by: QuanMCPC</p>
                <p>Language used: HTML, CSS, JS</p>
                <p>This allow user to edit picture from the browser online (and offline if you add this file to ServiceWorker).</p>
                <p>File has been optimized while also made it easy to read.</p>
                <hr>
                <button onclick="getId('about__').style.display = 'none'">Close</button>
                <hr>
            </div>
        </div>
        <div id="kbsc__">
            <div id="kbsc_"></div>
            <div id="kbsc">
                <hr>
                <h3 style="text-align: center;">Keyboard Shortcut</h3>
                <hr>
                <p><kbd>Alt + N</kbd>: New image</p>
                <p><kbd>Alt + S</kbd>: Save image (Default to PNG format)</p>
                <p><kbd>Alt + O</kbd>: Open image</p>
                <p><kbd>Alt + Z</kbd>: Undo</p>
                <p><kbd>Alt + Y</kbd>: Redo</p>
                <p><kbd>[P] key</kbd>: Pencil</p>
                <p><kbd>[E] key</kbd>: Eraser</p>
                <p><kbd>[C] key</kbd>: Color Picker</p>
                <hr>
                <button onclick="getId('kbsc__').style.display = 'none'">Close</button>
                <hr>
            </div>
        </div>
        <div id="fullscreen">
            <img src="" alt="Full screen image" id="fullscreen_">
        </div>
    </body>
    <script>
        function getId(id) { return document.getElementById(id) }
        function getCS(e, p) { return getComputedStyle(e, p) }
        function getClass(c) { return document.getElementsByClassName(c) }
        var tool_, unredo = [], unredoPos = 0, $canvas = getId("canvas"), type, id_, lockRatio_ = false, ratio = 0;
        document.body.onresize = resizeHandler
        function resizeHandler() {
            if (document.body.clientWidth <= 831) {
                getId("dropdown_files_").style.display = "block";
                var j = getId("normal_files").children.length;
                for (var i = 0; i < j; i++) { getId("dropdown_files").appendChild(getId("normal_files").children[0]) }
            }
            if (document.body.clientWidth >= 832) {
                getId("dropdown_files_").style.display = "none";
                var j_ = getId("dropdown_files").children.length;
                for (var i = 0; i < j_; i++) { getId("normal_files").appendChild(getId("dropdown_files").children[0]) }
            }
            if (document.body.clientWidth <= 684) {
                getId("dropdown_tools_").style.display = "block";
                var j = getId("normal_tools").children.length;
                for (var i = 0; i < j; i++) { getId("dropdown_tools").appendChild(getId("normal_tools").children[0]) }
            }
            if (document.body.clientWidth >= 685) {
                getId("dropdown_tools_").style.display = "none";
                var j_ = getId("dropdown_tools").children.length;
                for (var i = 0; i < j_; i++) { getId("normal_tools").appendChild(getId("dropdown_tools").children[0]) }
            }
        }
        document.body.onkeydown = function(e) {
            if (e.key == "z" && e.altKey) { undo() }
            if (e.key == "y" && e.altKey) { redo() }
            if (e.key == "n" && e.altKey) { newImage() }
            if (e.key == "s" && e.altKey) { saveImage() }
            if (e.key == "o" && e.altKey) { openImage() }
            if (e.key == "p") {
                resetAllTool();
                for (var i = 0; i < getClass('tool__pencil').length; i++) {  getClass('tool__pencil')[i].style.backgroundColor = '#999999' }
                tool_ = "pencil";
                getId('pencil_cursor_image').style.display = 'block';
                getId('pencil_cursor_image_2').style.display = 'block';
                getId('canvas').style.cursor = 'none';
            }
            if (e.key == "e") {
                resetAllTool();
                for (var i = 0; i < getClass('tool__eraser').length; i++) { getClass('tool__eraser')[i].style.backgroundColor = '#999999' }
                tool_ = "eraser";
                getId('cursor_image').style.display = 'block';
                getId('cursor_image').style.top = getId('canvas').getBoundingClientRect().top + window.scrollY + Number(getCS(getId('canvas')).borderWidth.replace(/\D+$/g, '')) + 'px';
                getId('cursor_image').style.left = getId('canvas').getBoundingClientRect().left + window.scrollX + Number(getCS(getId('canvas')).borderWidth.replace(/\D+$/g, '')) + 'px';
                getId('canvas').style.cursor = 'none';
            }
            if (e.key == "c") {
                resetAllTool();
                for (var i = 0; i < getClass('tool__colorPicker').length; i++) { getClass('tool__colorPicker')[i].style.backgroundColor = '#999999' }
                tool_ = "colorpicker";
            }
        }
        function lockRatio() {
            if (lockRatio_) {
                lockRatio_ = false;
                getId("lockRatio").style.backgroundColor = "";
                getId("canvas_width").removeEventListener("input", cTFR1);
                getId("canvas_height").removeEventListener("input", cTFR2);
                ratio = 0;
            } else {
                lockRatio_ = true;
                getId("lockRatio").style.backgroundColor = "#999999";
                ratio = getId("canvas_width").value / getId("canvas_height").value
                getId("canvas_width").addEventListener("input", cTFR1)
                getId("canvas_height").addEventListener("input", cTFR2)
            }
        }
        function cTFR1() { getId("canvas_height").value = getId("canvas_width").value / ratio }
        function cTFR2() { getId("canvas_width").value = getId("canvas_height").value * ratio }
        function fullS() {
            getId("fullscreen").style.display = 'block';
            if (getId("fullscreen").requestFullscreen) { getId("fullscreen").requestFullscreen() } else if (getId("fullscreen").webkitRequestFullscreen) { getId("fullscreen").webkitRequestFullscreen() } else if (getId("fullscreen").msRequestFullscreen) { getId("fullscreen").msRequestFullscreen() }
            if (!getId("backgroundTransparent").checked) { getId("fullscreen_").src = canvasToImage("#ffffff", $canvas) } else { getId("fullscreen_").src = $canvas.toDataURL(type) }
        }
        getId("fullscreen").addEventListener("click", e => {
            getId("fullscreen").style.display = "none";
            if (document.exitFullscreen) { document.exitFullscreen() } else if (document.webkitExitFullscreen) { document.webkitExitFullscreen() } else if (document.msExitFullscreen) { document.msExitFullscreen() }
        })
        function showKS() { getId('kbsc__').style.display = 'block' }
        function reloadImage(b64img, cs) {
            var img = new Image();
            img.onload = function() {
                var w = img.width, h = img.height;
                cs.setAttribute("width", w);
                cs.setAttribute("height", h);
                cs.style.width = w + "px";
                cs.style.height = h + "px";
                cs.parentElement.style.width = w;
                cs.parentElement.style.height = h;
                getId("canvas_width").value = w;
                getId("canvas_height").value = h;
                ratio = getId("canvas_width").value / getId("canvas_height").value;
                cs.getContext("2d").clearRect(0, 0, cs.style.width, cs.style.height);
                cs.getContext("2d").drawImage(img, 0, 0);
            }
            img.src = b64img;
        }
        function undo() { if (unredoPos < unredo.length - 1) { unredoPos++; reloadImage(unredo[unredoPos], $canvas); } }
        function redo() { if (unredoPos > 0) { unredoPos--; reloadImage(unredo[unredoPos], $canvas); } }
        function showAbout() { getId("about__").style.display = "block" }
        function canvasToImage(backgroundColor, canvas_elm) {
            var canvas = canvas_elm, context = canvas_elm.getContext("2d"), w = canvas.width, h = canvas.height, data
            if (backgroundColor) {
                data = context.getImageData(0, 0, w <= 1 ? 1 : w, h <= 1 ? 1 : h);
                var compositeOperation = context.globalCompositeOperation;
                context.globalCompositeOperation = "destination-over";
                context.fillStyle = backgroundColor;
                context.fillRect(0, 0, w <= 1 ? 1 : w, h <= 1 ? 1 : h);
            }
            var imageData = this.canvas.toDataURL(type);
            if (backgroundColor) {
                context.clearRect(0, 0, w <= 1 ? 1 : w, h <= 1 ? 1 : h);
                context.putImageData(data, 0, 0);
                context.globalCompositeOperation = compositeOperation;
            }
            return imageData;
        }
        function resetAllTool() {
            document.querySelectorAll(".tool__").forEach((value, key) => { value.style.backgroundColor = "" })
            for (var i = 0; i < getClass("cursor_").length; i++) { getClass("cursor_")[i].style.display = "none" }
            $canvas.style.cursor = "auto";
        }
        var memctx, xhr = new XMLHttpRequest()
        getId("canvas_width").addEventListener("change", e => { cHIE(false); cWIE(false); })
        getId("canvas_height").addEventListener("change", e => { cHIE(false); cWIE(false); })
        getId("image_width").addEventListener("change", e => { cHIE(true); cWIE(true) })
        getId("image_height").addEventListener("change", e => { cHIE(true); cWIE(true) })
        function cHIE(scaling) {
            memctx = canvasToImage("#ffffff", $canvas)
            getId("canvas_width").value = getId("image_width").value
            getId("canvas_height").value = getId("image_height").value
            if (!!getId("canvas_height").value) {
                $canvas.setAttribute("height", getId("canvas_height").value);
                $canvas.style.height = getId("canvas_height").value + "px";
            }
            $canvas.parentElement.style.height = getId("canvas_height").value + "px";
        }
        function cWIE(scaling) {
            getId("canvas_width").value = getId("image_width").value
            getId("canvas_height").value = getId("image_height").value
            if (!!getId("canvas_width").value) {
                $canvas.setAttribute("width", getId("canvas_width").value)
                $canvas.style.width = getId("canvas_width").value + "px"
            }
            var img = new Image();
            img.src = memctx;
            img.onload = function() {
                $canvas.getContext("2d").drawImage(img, 0, 0, scaling ? getId("image_width").value : null, scaling ? getId("image_height").value : null)
            }
            $canvas.parentElement.style.width = getId("canvas_width").value + "px";
        }
        getId("eraser_size").addEventListener("change", (e) => {
            getId("child_cursor_image").setAttribute("width", getId("eraser_size").value);
            getId("child_cursor_image").setAttribute("height", getId("eraser_size").value);
        })
        getId("brush_size").addEventListener("change", (e) => {
            getId("child_pencil_cursor_image").setAttribute("width", getId("brush_size").value);
            getId("child_pencil_cursor_image").setAttribute("height", getId("brush_size").value);
        })
        getId("brush_color").addEventListener("input", (e) => { getId("child_pencil_cursor_image_child").setAttribute("fill", getId("brush_color").value) })
        function newImage() { $canvas.getContext("2d").clearRect(0, 0, $canvas.getBoundingClientRect().width, $canvas.getBoundingClientRect().height) }
        function saveImage(saveAsBase64) {
            var link = document.createElement("a"), link_;
            for (var i = 0; i < document.getElementsByName("filetype").length; i++) { if (document.getElementsByName("filetype")[i].checked) { type = document.getElementsByName("filetype")[i].value; id_ = document.getElementsByName("filetype")[i].getAttribute("data-extension") } }
            for (var i = 0; i < document.getElementsByName("filetype1").length; i++) { if (document.getElementsByName("filetype1")[i].checked) { type = document.getElementsByName("filetype1")[i].value; id_ = document.getElementsByName("filetype1")[i].getAttribute("data-extension") } }
            if (!getId("backgroundTransparent").checked) { link_ = canvasToImage("#ffffff", $canvas) } else { link_ = $canvas.toDataURL(type) }
            if (saveAsBase64) {
                link.download = "canvasImage.txt";
                var a = new Blob([link_], { type: "text/plain" }), b = URL.createObjectURL(a)
                link.href = b
            } else {
                link.download = `canvasImage.${id_ == undefined ? "png" : id_}`;
                link.href = link_
            }
            link.click();
            link.delete;
        }
        function openImage(oAb64_) {
            openFile();
            function clickElem(elem) {
                var eventMouse = document.createEvent("MouseEvents");
                eventMouse.initMouseEvent("click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                elem.dispatchEvent(eventMouse);
            }
            function openFile() {
                readFile = function(e) {
                    var file = e.target.files[0];
                    if (!file) { return }
                    var reader = new FileReader();
                    reader.onload = function(e) { reloadImage(e.target.result, $canvas) }
                    if (oAb64_) { reader.readAsText(file) } else { reader.readAsDataURL(file) }
                }
                fileInput = document.createElement("input");
                fileInput.type = 'file';
                fileInput.accept = oAb64_ ? 'text/plain' : 'image/*';
                fileInput.style.display = 'none';
                fileInput.onchange = readFile;
                document.body.appendChild(fileInput);
                clickElem(fileInput);
            }
        }
        function rgbToHex2(r, g, b) {
            if (r > 255 || g > 255 || b > 255) throw "Invalid color";
            return ((r << 16) | (g << 8) | b).toString(16)
        }
        var hexDigits = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
        function rgb2hex(rgb) {
            rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            return "#" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
        }
        function hex(x) { return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16] }
        document.body.onload = e => {
            resizeHandler()
            unredo.unshift($canvas.toDataURL(type))
            getId("eraser_size").setAttribute("max", getId("canvas_width").value >= getId("canvas_height").value ? getId("canvas_width").value : getId("canvas_height").value)
            var flag, dot_flag = false, prevX, prevY, currX, currY = 0
            var ctx = $canvas.getContext('2d');
            $canvas.onmouseout = function(e) { getId("cursor_image").style.display = "none" }
            $canvas.onmousemove = $canvas.onmousedown = $canvas.onmouseup = function(e) {
                if (tool_ == "eraser") { getId("cursor_image").style.display = "block" }
                prevX = currX;
                prevY = currY;
                currX = e.clientX - $canvas.offsetLeft - Number(getCS($canvas).borderWidth.replace(/\D+$/g, "")) + window.pageXOffset || (document.documentElement || document.body.parentNode || document.body).scrollLeft;
                currY = e.clientY - $canvas.offsetTop - Number(getCS($canvas).borderWidth.replace(/\D+$/g, "")) + window.pageYOffset || (document.documentElement || document.body.parentNode || document.body).scrollTop;
                getId("cursor_image").style.top = e.clientY - Number(getCS(getId("cursor_image")).height.replace(/\D+$/g, "") / 2) + "px";
                getId("cursor_image").style.left = e.clientX - Number(getCS(getId("cursor_image")).width.replace(/\D+$/g, "") / 2) + "px";
                getId("pencil_cursor_image").style.left = e.clientX - Number(getCS(getId("pencil_cursor_image")).width.replace(/\D+$/g, "") / 2) + "px";
                getId("pencil_cursor_image").style.top = e.clientY - Number(getCS(getId("pencil_cursor_image")).height.replace(/\D+$/g, "") / 2) + "px";
                getId("pencil_cursor_image_2").style.left = e.clientX - Number(getCS(getId("pencil_cursor_image_2")).width.replace(/\D+$/g, "") / 2) + "px";
                getId("pencil_cursor_image_2").style.top = e.clientY - Number(getCS(getId("pencil_cursor_image_2")).height.replace(/\D+$/g, "") / 2) + "px";
                if (e.type == 'mousedown') {
                    flag = true;
                    if (tool_ == "colorpicker") {
                        var colorData = ctx.getImageData(currX, currY, 1, 1).data
                        if (colorData[3] == 0) { getId("brush_color").value = "#ffffff" } else { getId("brush_color").value = rgb2hex("rgb(" + colorData[0] + "," + colorData[1] + "," + colorData[2] + ")") }
                    }
                }
                document.body.addEventListener("mouseup", () => { flag = false })
                if (e.type == 'mouseup' || e.type == 'mouseout') {
                    flag = false;
                    if ($canvas.toDataURL(type) != unredo[0]) {
                        unredo.unshift($canvas.toDataURL(type))
                    }
                }
                if (e.type == 'mousemove' || e.type == 'mousedown') {
                    if (flag) {
                        if (tool_ == "pencil") {
                            ctx.beginPath();
                            ctx.globalCompositeOperation="source-over";
                            ctx.moveTo(prevX, prevY);
                            ctx.lineTo(currX, currY);
                            ctx.strokeStyle = getId("brush_color").value;
                            ctx.lineWidth = getId("brush_size").value;
                            ctx.lineCap = 'round';
                            ctx.stroke();
                        } else if (tool_ == "eraser") {
                            ctx.globalCompositeOperation = "destination-out";
                            ctx.fillRect(currX - (getId("eraser_size").value / 2), currY - (getId("eraser_size").value / 2), getId("eraser_size").value, getId("eraser_size").value)
                        }
                    }
                }
            }
        };
    </script>
</html>